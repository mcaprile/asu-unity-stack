<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="asu-spotlight-styles.html">

<!--
    `mp-slider` is a simple web component image slider

    ### Example
 
    <mp-slider>
    <div>
    <img src="images/img1.jpg" />
    <mp-caption slider-header="Kung Fu Panda"
    slider-content="Po and the legends of awesomeness">
    </mp-caption>
    </div>
    </mp-slider>

    @demo demo/index.html
-->

<dom-module id="asu-spotlight">
    <template>
        <style include="asu-spotlight-styles"></style>

        <div class="slidecontainer">
            <img class="asu-spotlight-image" src="[[imageLink]]" width="1000" height="1000" alt="[[imageAlt]]" title="[[imageAlt]]">           
            <div class="blurbcontainer">
                <div class$="blurbshell {{textPosition}} {{overlayTextWidth}}">
                    <a href="[[titleLink]]">
                        <h1>[[title]]</h1>
                    </a>
                    <p></p>
                    <a class$="btn {{buttonColor}} btn-block" href="[[buttonLinkOne]]">[[buttonTextOne]]</a>
                </div>
            </div>
            <slot></slot>
        </div>

    </template>

    <script>
class asuSpotlight extends Polymer.Element {
    static get is() {
        return 'asu-spotlight';
    }

    static get properties() {
        return {
            title: String,

            titleLink: String,

            imageAlt: String,

            tagline: String,

            imageLink: String,

            buttonLinkOne: String,

            buttonTextOne: String,

            buttonLinkTwo: String,

            buttonTextTwo: String,

            buttonColor: String,

            textPosition: String,

            overlayTextWidth: String
        };
    }

    constructor() {
        super();
    }

    connectedCallback() {
        super.connectedCallback();
    }

    buttonColorChanged(buttonColor) {

    }

    textPositionChanged(textPosition) {

    }

    _createSlider() {
        this._thumbPreview;
        this._images = [].slice.call(this.children);
        this.current = 0;

        this._images.forEach((slide, i) => {
            this._thumbPreview.push(slide.firstElementChild);
            this._images[i].setAttribute("data-index", i);
            this._images[i].classList.add("slider-img");
            this._images[i].children[0].style.width = "100%"; // ::slotted(.slider-img img) is not supported???
            this._images[i].children[0].style.float = "left";

            if (i === this.current) {
                this._images[i].classList.add("current");
            }
        });
    }

    _prevSlide() {
        this._images[this.current].classList.remove("current");
        this.current = this.current === 0 ? this._images.length - 1 : this.current - 1;
        this._images[this.current].classList.add("current");

        if (this.bullets) {
            this._changeBullet();
        }

        if (this.showThumbs) {
            this._changeThumb();
        }
    }

    _nextSlide() {
        this._images[this.current].classList.remove('current');
        this.current = this.current === this._images.length - 1 ? 0 : this.current + 1;
        this._images[this.current].classList.add('current');

        if (this.bullets) {
            this._changeBullet();
        }

        if (this.showThumbs) {
            this._changeThumb();
        }
    }

    // change image and update selected thumb and bullet
    _updateSelected(e) {
        var thumbIndex = e.currentTarget.dataset.index;

        this._images[this.current].classList.remove("current");

        if (this.bullets) {
            var dotsList = this.shadowRoot.querySelector('#bullets').getElementsByTagName('li');
            var prevDot = dotsList[this.current];
            var nextDot = dotsList[thumbIndex];

            prevDot.firstElementChild.classList.remove("selected");
            nextDot.firstElementChild.classList.add("selected");
        }

        if (this.showThumbs) {
            var thumbList = this.shadowRoot.querySelector('#thumbs').getElementsByTagName('div');
            var prevThumb = thumbList[this.current];
            var nextThumb = thumbList[thumbIndex];

            prevThumb.classList.remove("selected");
            nextThumb.classList.add("selected");
        }

        this.current = parseInt(thumbIndex === this._images.length - 1 ? 0 : thumbIndex);
        this._images[this.current].classList.add("current");
    }

    _changeBullet() {
        const bulletList = this.shadowRoot.querySelector('#bullets').getElementsByTagName('li');

        Object.keys(bulletList).forEach((i) => {
            i = parseInt(i, 10);
            const currentDots = bulletList[i].firstElementChild;
            const dotsIndex = parseInt(bulletList[i].firstElementChild.dataset.index);

            if (this.current !== dotsIndex) {
                currentDots.classList.remove("selected");
            }
            else {
                currentDots.classList.add("selected");
            }
        });
    }

    _createThumbs() {
        var thumbList;

        this._thumbs = this._images.map((img, i) => {
            return {
                image: img.firstElementChild.getAttribute('src'),
                class: i == this.current ? "selected" : "",
                dataIndex: i
            };
        });
    }

    // show an image preview on bullet hover
    _showThumb(elem, i) {
        var self = this;
        var dotsIndex = parseInt(elem.currentTarget.firstElementChild.getAttribute("data-index"));

        this._thumbPreview.forEach((img, i) => {
            if (dotsIndex === i) {
                return self._selectedThumb = img.getAttribute('src');
            }
        });
    }

    // update selected thumb on next/prev method
    _changeThumb() {
        const thumbList = this.shadowRoot.querySelector('#thumbs').getElementsByTagName('div');

        Object.keys(thumbList).forEach((i) => {
            i = parseInt(i, 10);
            var currentThumb = thumbList[i];
            var thumbsIndex = parseInt(thumbList[i].firstElementChild.getAttribute("data-index"));

            if (this.current !== thumbsIndex) {
                currentThumb.classList.remove("selected");
            }
            else {
                currentThumb.classList.add("selected");
            }
        });
    }

    _autoPlaySlider() {
        // var self = this;
        this._autoInternal = setInterval(() => {
            this._images[this.current].classList.remove("current");
            this.current = this.current === this._images.length - 1 ? 0 : this.current + 1;
            this._images[this.current].classList.add("current");
            this._changeBullet();
            this._changeThumb();
        }, this.interval);
    }

    _pauseAutoPlay() {
        if (this.autoPlay) {
            clearInterval(this._autoInternal);
            this.$.pauseIcon.style.opacity = .5;
        }
    }

    _resumeAutoPlay() {
        if(this.autoPlay) {
            this._autoPlaySlider();
            this.$.pauseIcon.style.opacity = 0;
        }
    }
}

customElements.define(asuSpotlight.is, asuSpotlight);
    </script>
</dom-module>
